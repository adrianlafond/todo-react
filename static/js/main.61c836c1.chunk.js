(this["webpackJsonptodo-react"]=this["webpackJsonptodo-react"]||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,o){},function(e,t,o){},,function(e,t,o){},function(e,t,o){},function(e,t,o){},function(e,t,o){"use strict";o.r(t);var n=o(1),c=o.n(n),a=o(8),r=o.n(a),i=(o(16),o(11)),s=o(2),d=c.a.createContext({idJustAdded:-1,idNextFocus:-1,clearIdJustAdded:function(){},clearNextFocus:function(){}}),u=o(3),l=o.n(u),f=(o(17),o(0)),b=c.a.memo((function(e){var t=e.complete,o=void 0!==t&&t,n=e.id,a=e.text,r=void 0===a?"":a,i=e.onCompleteChange,u=void 0===i?function(){}:i,b=e.onDelete,m=void 0===b?function(){}:b,h=e.onTextChange,x=void 0===h?function(){}:h,j=e.onModeChange,v=void 0===j?function(){}:j,p=c.a.useContext(d),_=c.a.useRef(null),w=c.a.useRef(null),g=c.a.useRef(r),O=c.a.useState(r),k=Object(s.a)(O,2),N=k[0],y=k[1],T=c.a.useState(!1),S=Object(s.a)(T,2),C=S[0],I=S[1],F=c.a.useState("none"),E=Object(s.a)(F,2),P=E[0],A=E[1];function D(e){A(e),v(n,e)}function R(){u(n,!o)}function B(){I(!0),D("confirm-delete")}function W(){I(!1),D("focus")}function q(){m(n),D("none")}function J(){x(n,N)}var M=c.a.useCallback((function(){w.current&&(g.current=N,w.current.focus(),w.current.setSelectionRange(0,w.current.value.length,"forward"))}),[w,N]);function L(){_.current&&_.current.focus()}c.a.useEffect((function(){p.idJustAdded===n&&M()}),[n,p,M]),c.a.useEffect((function(){_.current&&p.idNextFocus===n&&(_.current.focus(),p.clearNextFocus(n))}),[n,p,_]);var U="none"!==P;return Object(f.jsx)("div",{className:l()("todo-item",{"todo-item--complete":o,"todo-item--focus":U}),tabIndex:0,onKeyDown:function(e){if(C)switch(e.key){case"Escape":W();break;case"Enter":case"Space":q()}else if(document.activeElement===w.current)switch(e.key){case"Enter":L(),J();break;case"Escape":L(),y(g.current)}else switch(e.key){case"Enter":case" ":R();break;case"Backspace":case"Delete":B();break;case"i":case"I":e.preventDefault(),M()}},ref:_,onFocus:function(){D("focus")},onBlur:function(e){setTimeout((function(){var e=_.current;e&&e!==document.activeElement&&!e.contains(document.activeElement)&&(C&&I(!1),D("none"))}),0)},children:Object(f.jsx)("div",{className:l()("todo-item__content",{"todo-item__content--focus":U}),children:C?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{tabIndex:-1,"data-testid":"todo-item__delete-cancel",className:"todo-item__delete-cancel todo-item__child","aria-label":"Cancel delete",onClick:W,children:"Cancel"}),Object(f.jsx)("button",{tabIndex:-1,"data-testid":"todo-item__delete-confirm",className:"todo-item__delete-confirm todo-item__child","aria-label":"Confirm delete",onClick:q,children:"Yes, delete"})]}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("div",{className:"todo-item__complete todo-item__child",children:[Object(f.jsx)("div",{className:"todo-item__complete-checkbox",children:Object(f.jsx)("div",{className:l()("todo-item__complete-checkbox-hit",{"todo-item__complete-checkbox-hit--focus":U,"todo-item__complete-checkbox-hit--complete":o}),children:Object(f.jsx)("div",{className:l()("todo-item__complete-checkbox-hit-check",{"todo-item__complete-checkbox-hit-check--focus":U&&o,"todo-item__complete-checkbox-hit-check--complete":o})})})}),Object(f.jsxs)("label",{className:"todo-item__complete-label",children:["Mark ".concat(N," as complete"),Object(f.jsx)("input",{tabIndex:-1,type:"checkbox","data-testid":"todo-item__complete",className:"todo-item__complete-input",checked:o,onChange:R})]})]}),Object(f.jsx)("label",{className:"todo-item__text-label",children:Object(f.jsx)("input",{tabIndex:-1,"data-testid":"todo-item__text",className:l()("todo-item__text","todo-item__child",{"todo-item__text--complete":o,"todo-item__text--focus":U}),ref:w,value:N,onInput:function(e){p.clearIdJustAdded(n),y(e.target.value)},onBlur:function(){J()},onFocus:function(e){e.stopPropagation(),M(),D("edit-text")}})}),Object(f.jsxs)("button",{tabIndex:-1,"data-testid":"todo-item__delete",className:"todo-item__delete todo-item__child","aria-label":"Delete",onClick:B,children:[Object(f.jsx)("div",{className:l()("todo-item__delete-swipe","todo-item__delete-swipe-1",{"todo-item__delete-swipe--complete":o,"todo-item__delete-swipe--focus":U})}),Object(f.jsx)("div",{className:l()("todo-item__delete-swipe","todo-item__delete-swipe-2",{"todo-item__delete-swipe--complete":o,"todo-item__delete-swipe--focus":U})})]})]})})})})),m=(o(19),function(e){var t=e.onAdd,o=e.onFocus,n=e.onBlur,a=c.a.useContext(d),r=c.a.useRef(null);return c.a.useEffect((function(){0===a.idNextFocus&&r.current&&r.current.focus()}),[a,r]),Object(f.jsx)("div",{className:"todo-add-item",children:Object(f.jsx)("button",{className:"todo-add-item__button",onClick:t,onFocus:o,onBlur:n,ref:r,children:"+"})})}),h=(o(20),c.a.memo((function(e){var t=e.todoStatus,o=e.errorMessage,n=c.a.useRef(null),a=c.a.useState(),r=Object(s.a)(a,2),i=r[0],d=r[1],u=c.a.useRef(0);if(c.a.useEffect((function(){return d(o),o&&(window.clearTimeout(u.current),u.current=window.setTimeout((function(){d(void 0)}),5e3)),function(){return window.clearTimeout(u.current)}}),[o]),t){var b=t.id,m=t.mode;"none"===m&&n.current&&n.current.id!==b||(n.current="none"===m?null:t)}var h="";if(n.current)switch(n.current.mode){case"focus":h=Object(f.jsxs)(f.Fragment,{children:["Press ",Object(f.jsx)("strong",{children:"enter"})," to toggle the complete state, ",Object(f.jsx)("strong",{children:"i"})," to edit text, ",Object(f.jsx)("strong",{children:"delete"})," to delete this todo."]});break;case"edit-text":h=Object(f.jsxs)(f.Fragment,{children:["Press ",Object(f.jsx)("strong",{children:"enter"})," to finish editing, ",Object(f.jsx)("strong",{children:"esc"})," to cancel."]});break;case"confirm-delete":h=Object(f.jsxs)(f.Fragment,{children:["Press ",Object(f.jsx)("strong",{children:"esc"})," to cancel or ",Object(f.jsx)("strong",{children:"enter"})," to confirm."]})}return Object(f.jsxs)("div",{className:"status-bar",children:[Object(f.jsx)("p",{className:l()("status-bar__text","status-bar__error",{"status-bar__text--active":i}),children:i}),Object(f.jsx)("p",{className:l()("status-bar__text","status-bar__info",{"status-bar__text--active":h}),children:h})]})}))),x=o(5),j=o(9),v=o(10),p="todos",_="todos",w=function(){function e(){Object(j.a)(this,e),this.db=void 0,e.confirmIndexedDb()}return Object(v.a)(e,[{key:"reset",value:function(){var e;null===(e=this.db)||void 0===e||e.close(),window.indexedDB.deleteDatabase(p)}},{key:"open",value:function(){var e=this;return new Promise((function(t,o){var n=window.indexedDB.open(p,1);n.onupgradeneeded=e.onUpgradeNeeded.bind(e),n.onblocked=function(){o("Please close all other tabs with this site open so the database can be updated. Thank you.")},n.onerror=function(){o("Todos will not be saved or restored because database failed to open.")},n.onsuccess=function(){e.db=n.result,t(e)}}))}},{key:"createTodo",value:function(e){var t=this;return new Promise((function(o,n){if(t.db){var c=t.db.transaction([p],"readwrite").objectStore(_).add(Object(x.a)({complete:!1,text:""},e));c.onsuccess=function(e){t.readTodo(e.target.result).then(o).catch(console.log)},c.onerror=function(){n("Todo was not created because a database error occurred.")}}else n("Request to store a todo failed because database does not exist")}))}},{key:"readTodo",value:function(e){var t=this;return new Promise((function(o,n){if(t.db){var c=t.db.transaction([p]).objectStore(_).get(e);c.onsuccess=function(t){t.target.result?o(t.target.result):n("No todo with id ".concat(e," was found."))},c.onerror=function(){n("Todo with id ".concat(e," could not be retrieved because a database error occurred."))}}else n("Request to read todo ".concat(e," failed because database does not exist"))}))}},{key:"readAllTodos",value:function(){var e=this;return new Promise((function(t,o){if(e.db){var n=e.db.transaction([p]).objectStore(_).getAll();n.onsuccess=function(e){t(e.target.result)},n.onerror=function(){o("Todos could not be retrieved because a database error occurred.")}}else o("Request to read all todos failed because database does not exist.")}))}},{key:"updateTodo",value:function(e,t){var o=this;return new Promise((function(n,c){o.db?o.readTodo(e).then((function(a){if(o.db){var r=o.db.transaction([p],"readwrite").objectStore(_).put(Object(x.a)(Object(x.a)(Object(x.a)({},a),t),{},{id:a.id}));r.onsuccess=function(e){n(e.target.result)},r.onerror=function(){c("Todo with id ".concat(e," could not be updated because a database error occurred."))}}})).catch((function(e){c(e)})):c("Request to read todo ".concat(e," failed because database does not exist"))}))}},{key:"deleteTodo",value:function(e){var t=this;return new Promise((function(o,n){if(t.db){var c=t.db.transaction([p],"readwrite").objectStore(_).delete(e);c.onsuccess=function(){o(e)},c.onerror=function(e){n(e.target.result)}}else n("Request to delete todo ".concat(e," failed because database does not exist"))}))}},{key:"onUpgradeNeeded",value:function(e){this.db=e.target.result;var t=this.db.createObjectStore(_,{keyPath:"id",autoIncrement:!0});t.createIndex("id","id",{unique:!0}),t.createIndex("text","text",{unique:!1}),t.createIndex("complete","complete",{unique:!1}),t.createIndex("due","due",{unique:!1}),t.add({text:"What do you need to do?",complete:!1,due:"Tuesday"})}}],[{key:"confirmIndexedDb",value:function(){if(!window.indexedDB)throw new Error("Todos will not be saved because your browser does not support IndexedDB.")}}]),e}();o(21);function g(){var e=c.a.useRef(new w),t=c.a.useState(-1),o=Object(s.a)(t,2),n=o[0],a=o[1],r=c.a.useState(-1),u=Object(s.a)(r,2),l=u[0],x=u[1],j=c.a.useState(null),v=Object(s.a)(j,2),p=v[0],_=v[1],g=c.a.useRef(-1),O=c.a.useState([]),k=Object(s.a)(O,2),N=k[0],y=k[1],T=c.a.useState(),S=Object(s.a)(T,2),C=S[0],I=S[1];function F(e,t){P(e,"complete",t)}function E(e,t){P(e,"text",t)}function P(t,o,n){var c=N.slice(0),a=c[N.findIndex((function(e){return e.id===t}))];"complete"===o?a.complete=n:"text"===o&&(a.text=n),y(c),e.current.updateTodo(a.id,a)}function A(t){var o=N.slice(0),n=o.findIndex((function(e){return e.id===t}));n<o.length-1?x(o[n+1].id):n>0&&x(o[n-1].id),a(-1),o.splice(n,1),y(o),e.current.deleteTodo(t)}function D(e,t){"none"===t&&e===g.current?g.current=-1:"none"!==t&&(g.current=e),_({id:e,mode:t})}c.a.useEffect((function(){e.current.open().then((function(){e.current.readAllTodos().then((function(e){x(e[0]?e[0].id:-1),y(e)})).catch(I)})).catch(I)}),[]),c.a.useEffect((function(){var e=function(e){var t="ArrowUp"===e.key,o="ArrowDown"===e.key;if(t||o){e.preventDefault();var n=N.findIndex((function(e){return e.id===g.current}));document.body.focus(),t?0===g.current?x(N[N.length-1].id):n>0?x(N[n-1].id):(-1===g.current&&(g.current=0),x(g.current)):o&&(n<N.length-1&&-1!==n?x(N[n+1].id):n===N.length-1?x(0):(-1===g.current&&(g.current=N[0].id),x(g.current)))}};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[N]);var R=c.a.useMemo((function(){return{idJustAdded:n,idNextFocus:l,clearIdJustAdded:function(e){e===n&&a(-1)},clearNextFocus:function(e){e===l&&x(-1)}}}),[n,l]);return Object(f.jsx)(d.Provider,{value:R,children:Object(f.jsxs)("main",{className:"app",children:[Object(f.jsxs)("div",{className:"app__content",children:[N.map((function(e){return Object(f.jsx)(b,{id:e.id,complete:e.complete,text:e.text,onCompleteChange:F,onDelete:A,onTextChange:E,onModeChange:D},"todo-".concat(e.id))})),Object(f.jsx)(m,{onAdd:function(){e.current.createTodo({text:"What needs doing?"}).then((function(e){a(e.id),y([].concat(Object(i.a)(N),[e]))})).catch(I)},onFocus:function(){g.current=0,0===l&&x(-1)},onBlur:function(){0===g.current&&(g.current=-1)}})]}),Object(f.jsx)(h,{todoStatus:p,errorMessage:C})]})})}var O=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function k(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var o=e.installing;null!=o&&(o.onstatechange=function(){"installed"===o.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var N=function(e){e&&e instanceof Function&&o.e(3).then(o.bind(null,23)).then((function(t){var o=t.getCLS,n=t.getFID,c=t.getFCP,a=t.getLCP,r=t.getTTFB;o(e),n(e),c(e),a(e),r(e)}))};r.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(g,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/todo-react",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/todo-react","/service-worker.js");O?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(o){var n=o.headers.get("content-type");404===o.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):k(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):k(t,e)}))}}(),N()}],[[22,1,2]]]);
//# sourceMappingURL=main.61c836c1.chunk.js.map