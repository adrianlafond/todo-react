(this["webpackJsonptodo-react"]=this["webpackJsonptodo-react"]||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,o){},function(e,t,o){},,function(e,t,o){},function(e,t,o){},function(e,t,o){},function(e,t,o){"use strict";o.r(t);var n=o(1),c=o.n(n),a=o(8),r=o.n(a),i=(o(16),o(11)),d=o(2),s=c.a.createContext({idJustAdded:-1,idNextFocus:-1,clearIdJustAdded:function(){},clearNextFocus:function(){}}),u=o(3),l=o.n(u),f=(o(17),o(0)),b=c.a.memo((function(e){var t=e.complete,o=void 0!==t&&t,n=e.id,a=e.text,r=void 0===a?"":a,i=e.onCompleteChange,u=void 0===i?function(){}:i,b=e.onDelete,m=void 0===b?function(){}:b,h=e.onTextChange,x=void 0===h?function(){}:h,j=e.onModeChange,v=void 0===j?function(){}:j,p=c.a.useContext(s),_=c.a.useRef(null),g=c.a.useRef(null),w=c.a.useRef(r),k=c.a.useState(r),O=Object(d.a)(k,2),N=O[0],y=O[1],T=c.a.useState(!1),C=Object(d.a)(T,2),I=C[0],S=C[1],F=c.a.useState("none"),E=Object(d.a)(F,2),P=E[0],A=E[1];function D(e){A(e),v(n,e)}function R(){u(n,!o)}function B(){S(!0),D("confirm-delete")}function W(){S(!1),D("focus")}function q(){m(n),D("none")}function J(){x(n,N)}var U=c.a.useCallback((function(){g.current&&(w.current=N,g.current.focus(),g.current.setSelectionRange(0,g.current.value.length,"forward"))}),[g,N]);function L(){_.current&&_.current.focus()}c.a.useEffect((function(){p.idJustAdded===n&&U()}),[n,p,U]),c.a.useEffect((function(){_.current&&p.idNextFocus===n&&(_.current.focus(),p.clearNextFocus(n))}),[n,p,_]);var M="none"!==P;return Object(f.jsx)("div",{className:l()("todo-item",{"todo-item--complete":o,"todo-item--focus":M}),tabIndex:0,onKeyDown:function(e){if(I)switch(e.key){case"Escape":W();break;case"Enter":case"Space":q()}else if(document.activeElement===g.current)switch(e.key){case"Enter":L(),J();break;case"Escape":L(),y(w.current)}else switch(e.key){case"Enter":case" ":R();break;case"Backspace":case"Delete":B();break;case"i":case"I":e.preventDefault(),U()}},ref:_,onFocus:function(){D("focus")},onBlur:function(e){setTimeout((function(){var e=_.current;e&&e!==document.activeElement&&!e.contains(document.activeElement)&&(I&&S(!1),D("none"))}),0)},children:Object(f.jsx)("div",{className:l()("todo-item__content",{"todo-item__content--focus":M}),children:I?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{tabIndex:-1,"data-testid":"todo-item__delete-cancel",className:"todo-item__delete-cancel todo-item__child","aria-label":"Cancel delete",onClick:W,children:"Cancel"}),Object(f.jsx)("button",{tabIndex:-1,"data-testid":"todo-item__delete-confirm",className:"todo-item__delete-confirm todo-item__child","aria-label":"Confirm delete",onClick:q,children:"Yes, delete"})]}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("div",{className:"todo-item__complete todo-item__child",children:[Object(f.jsx)("div",{className:"todo-item__complete-checkbox",children:Object(f.jsx)("div",{className:l()("todo-item__complete-checkbox-hit",{"todo-item__complete-checkbox-hit--focus":M,"todo-item__complete-checkbox-hit--complete":o}),children:Object(f.jsx)("div",{className:l()("todo-item__complete-checkbox-hit-check",{"todo-item__complete-checkbox-hit-check--focus":M&&o,"todo-item__complete-checkbox-hit-check--complete":o})})})}),Object(f.jsxs)("label",{className:"todo-item__complete-label",children:["Mark ".concat(N," as complete"),Object(f.jsx)("input",{tabIndex:-1,type:"checkbox","data-testid":"todo-item__complete",className:"todo-item__complete-input",checked:o,onChange:R})]})]}),Object(f.jsx)("label",{className:"todo-item__text-label",children:Object(f.jsx)("input",{tabIndex:-1,"data-testid":"todo-item__text",className:l()("todo-item__text","todo-item__child",{"todo-item__text--complete":o,"todo-item__text--focus":M}),ref:g,value:N,onInput:function(e){p.clearIdJustAdded(n),y(e.target.value)},onBlur:function(){J()},onFocus:function(e){e.stopPropagation(),U(),D("edit-text")}})}),Object(f.jsxs)("button",{tabIndex:-1,"data-testid":"todo-item__delete",className:"todo-item__delete todo-item__child","aria-label":"Delete",onClick:B,children:[Object(f.jsx)("div",{className:l()("todo-item__delete-swipe","todo-item__delete-swipe-1",{"todo-item__delete-swipe--complete":o,"todo-item__delete-swipe--focus":M})}),Object(f.jsx)("div",{className:l()("todo-item__delete-swipe","todo-item__delete-swipe-2",{"todo-item__delete-swipe--complete":o,"todo-item__delete-swipe--focus":M})})]})]})})})})),m=(o(19),function(e){var t=e.onAdd,o=e.onFocus,n=e.onBlur,a=c.a.useContext(s),r=c.a.useRef(null);return c.a.useEffect((function(){0===a.idNextFocus&&r.current&&r.current.focus()}),[a,r]),Object(f.jsx)("div",{className:"todo-add-item",children:Object(f.jsx)("button",{className:"todo-add-item__button",onClick:t,onFocus:o,onBlur:n,ref:r,children:"+"})})}),h=(o(20),c.a.memo((function(e){var t=e.todoStatus,o=c.a.useRef(null);if(t){var n=t.id,a=t.mode;"none"===a&&o.current&&o.current.id!==n||(o.current="none"===a?null:t)}var r="";if(o.current)switch(o.current.mode){case"focus":r=Object(f.jsxs)(f.Fragment,{children:["Press ",Object(f.jsx)("strong",{children:"enter"})," to toggle the complete state, ",Object(f.jsx)("strong",{children:"i"})," to edit text, ",Object(f.jsx)("strong",{children:"delete"})," to delete this todo."]});break;case"edit-text":r=Object(f.jsxs)(f.Fragment,{children:["Press ",Object(f.jsx)("strong",{children:"enter"})," to finish editing, ",Object(f.jsx)("strong",{children:"esc"})," to cancel."]});break;case"confirm-delete":r=Object(f.jsxs)(f.Fragment,{children:["Press ",Object(f.jsx)("strong",{children:"esc"})," to cancel or ",Object(f.jsx)("strong",{children:"enter"})," to confirm."]})}return Object(f.jsx)("div",{className:"status-bar",children:Object(f.jsx)("p",{className:"status-bar__text",children:r})})}))),x=o(5),j=o(9),v=o(10),p="todos",_="todos",g=function(){function e(){Object(j.a)(this,e),this.db=void 0,e.confirmIndexedDb()}return Object(v.a)(e,[{key:"reset",value:function(){var e;null===(e=this.db)||void 0===e||e.close(),window.indexedDB.deleteDatabase(p)}},{key:"open",value:function(){var e=this;return new Promise((function(t,o){var n=window.indexedDB.open(p,1);n.onupgradeneeded=e.onUpgradeNeeded.bind(e),n.onblocked=function(){console.log("Please close all other tabs with this site open so the database can be updated. Thank you.")},n.onerror=function(){o("Todos will not be saved or restored because database failed to open.")},n.onsuccess=function(){e.db=n.result,t(e)}}))}},{key:"createTodo",value:function(e){var t=this;return new Promise((function(o,n){if(t.db){var c=t.db.transaction([p],"readwrite").objectStore(_).add(Object(x.a)({complete:!1,text:""},e));c.onsuccess=function(e){t.readTodo(e.target.result).then(o).catch(console.log)},c.onerror=function(){n("Todo was not created because a database error occurred.")}}else n("Request to store a todo failed because database does not exist")}))}},{key:"readTodo",value:function(e){var t=this;return new Promise((function(o,n){if(t.db){var c=t.db.transaction([p]).objectStore(_).get(e);c.onsuccess=function(t){t.target.result?o(t.target.result):n("No todo with id ".concat(e," was found."))},c.onerror=function(){n("Todo with id ".concat(e," could not be retrieved because a database error occurred."))}}else n("Request to read todo ".concat(e," failed because database does not exist"))}))}},{key:"readAllTodos",value:function(){var e=this;return new Promise((function(t,o){if(e.db){var n=e.db.transaction([p]).objectStore(_).getAll();n.onsuccess=function(e){t(e.target.result)},n.onerror=function(){o("Todos could not be retrieved because a database error occurred.")}}else o("Request to read all todos failed because database does not exist.")}))}},{key:"updateTodo",value:function(e,t){var o=this;return new Promise((function(n,c){o.db?o.readTodo(e).then((function(a){if(o.db){var r=o.db.transaction([p],"readwrite").objectStore(_).put(Object(x.a)(Object(x.a)(Object(x.a)({},a),t),{},{id:a.id}));r.onsuccess=function(e){n(e.target.result)},r.onerror=function(){c("Todo with id ".concat(e," could not be updated because a database error occurred."))}}})).catch((function(e){c(e)})):c("Request to read todo ".concat(e," failed because database does not exist"))}))}},{key:"deleteTodo",value:function(e){var t=this;return new Promise((function(o,n){if(t.db){var c=t.db.transaction([p],"readwrite").objectStore(_).delete(e);c.onsuccess=function(){o(e)},c.onerror=function(e){n(e.target.result)}}else n("Request to delete todo ".concat(e," failed because database does not exist"))}))}},{key:"onUpgradeNeeded",value:function(e){this.db=e.target.result,console.log("onUpgradeNeeded");var t=this.db.createObjectStore(_,{keyPath:"id",autoIncrement:!0});t.createIndex("id","id",{unique:!0}),t.createIndex("text","text",{unique:!1}),t.createIndex("complete","complete",{unique:!1}),t.createIndex("due","due",{unique:!1}),t.add({text:"What do you need to do?",complete:!1,due:"Tuesday"})}}],[{key:"confirmIndexedDb",value:function(){if(!window.indexedDB)throw new Error("Todos will not be saved because your browser does not support IndexedDB.")}}]),e}();o(21);var w=function(){var e=c.a.useRef(new g),t=c.a.useState(-1),o=Object(d.a)(t,2),n=o[0],a=o[1],r=c.a.useState(-1),u=Object(d.a)(r,2),l=u[0],x=u[1],j=c.a.useState(null),v=Object(d.a)(j,2),p=v[0],_=v[1],w=c.a.useRef(-1),k=c.a.useState([]),O=Object(d.a)(k,2),N=O[0],y=O[1];function T(e,t){I(e,"complete",t)}function C(e,t){I(e,"text",t)}function I(t,o,n){var c=N.slice(0),a=c[N.findIndex((function(e){return e.id===t}))];"complete"===o?a.complete=n:"text"===o&&(a.text=n),y(c),e.current.updateTodo(a.id,a)}function S(t){var o=N.slice(0),n=o.findIndex((function(e){return e.id===t}));n<o.length-1?x(o[n+1].id):n>0&&x(o[n-1].id),a(-1),o.splice(n,1),y(o),e.current.deleteTodo(t)}function F(e,t){"none"===t&&e===w.current?w.current=-1:"none"!==t&&(w.current=e),_({id:e,mode:t})}c.a.useEffect((function(){e.current.open().then((function(){e.current.readAllTodos().then((function(e){x(e[0]?e[0].id:-1),y(e)})).catch(console.log)})).catch(console.log)}),[]),c.a.useEffect((function(){var e=function(e){var t="ArrowUp"===e.key,o="ArrowDown"===e.key;if(t||o){e.preventDefault();var n=N.findIndex((function(e){return e.id===w.current}));document.body.focus(),t?0===w.current?x(N[N.length-1].id):n>0?x(N[n-1].id):(-1===w.current&&(w.current=0),x(w.current)):o&&(n<N.length-1&&-1!==n?x(N[n+1].id):n===N.length-1?x(0):(-1===w.current&&(w.current=N[0].id),x(w.current)))}};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[N]);var E=c.a.useMemo((function(){return{idJustAdded:n,idNextFocus:l,clearIdJustAdded:function(e){e===n&&a(-1)},clearNextFocus:function(e){e===l&&x(-1)}}}),[n,l]);return Object(f.jsx)(s.Provider,{value:E,children:Object(f.jsxs)("main",{className:"app",children:[Object(f.jsxs)("div",{className:"app__content",children:[N.map((function(e){return Object(f.jsx)(b,{id:e.id,complete:e.complete,text:e.text,onCompleteChange:T,onDelete:S,onTextChange:C,onModeChange:F},"todo-".concat(e.id))})),Object(f.jsx)(m,{onAdd:function(){e.current.createTodo({text:"What needs doing?"}).then((function(e){a(e.id),y([].concat(Object(i.a)(N),[e]))})).catch(console.log)},onFocus:function(){w.current=0,0===l&&x(-1)},onBlur:function(){0===w.current&&(w.current=-1)}})]}),Object(f.jsx)(h,{todoStatus:p})]})})},k=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function O(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var o=e.installing;null!=o&&(o.onstatechange=function(){"installed"===o.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var N=function(e){e&&e instanceof Function&&o.e(3).then(o.bind(null,23)).then((function(t){var o=t.getCLS,n=t.getFID,c=t.getFCP,a=t.getLCP,r=t.getTTFB;o(e),n(e),c(e),a(e),r(e)}))};r.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(w,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/todo-react",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/todo-react","/service-worker.js");k?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(o){var n=o.headers.get("content-type");404===o.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):O(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):O(t,e)}))}}(),N()}],[[22,1,2]]]);
//# sourceMappingURL=main.28919616.chunk.js.map